<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyAnime</title>
    <!-- Hapus link ke index.css -->
    <!-- <link rel="stylesheet" href="index.css"> -->
    <link rel="icon" href="Gambar/LogoMyanime (2).png" type="image/x-icon" />
    <!-- Tambahkan Font Awesome untuk ikon sosial media -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- ================================================== -->
    <!-- --- STYLE CSS (GABUNGAN index.css dan style partikel) --- -->
    <!-- ================================================== -->
    <style>
      /* Reset dan Base Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        min-height: 100vh;
        scroll-behavior: smooth;
      }

      body {
        background-color: #181818;
        color: #fff;
        font-family: sans-serif;
        font-weight: bold;
        overflow-x: hidden;
        background-image: radial-gradient(#021027, #000000);
        position: relative;
        z-index: 1;
      }
      body::-webkit-scrollbar {
        display: none;
      }

      /* ================================================== */
      /* --- STYLE BACKGROUND PARTIKEL BARU --- */
      /* ================================================== */

      #particles-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        z-index: -2;
        overflow: hidden;
      }

      .circle-container {
        position: absolute;
        width: 5px;
        height: 5px;
        transform: translateY(-10vh);
        animation-iteration-count: infinite;
        animation-timing-function: linear;
        animation-name: move-frames; /* Gunakan animasi gerak umum */
        animation-duration: 10s; /* Durasi default */
        animation-delay: 0s; /* Delay default */
      }

      .circle {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        mix-blend-mode: screen;
        background-image: radial-gradient(
          hsl(180, 100%, 80%),
          hsl(180, 100%, 80%) 10%,
          hsla(180, 100%, 80%, 0) 56%
        );
        animation: fade-frames 2s infinite ease-in-out alternate,
                   scale-frames 3s infinite ease-in-out;
      }

      @keyframes fade-frames {
        0%, 100% { opacity: 0.7; }
        50% { opacity: 1; }
      }

      @keyframes scale-frames {
        0%, 100% { transform: scale(0.5); }
        50% { transform: scale(1.5); }
      }

      @keyframes move-frames {
        from { transform: translate3d(-10vw, 110vh, 0); }
        to { transform: translate3d(110vw, -10vh, 0); }
      }

      /* Contoh manual beberapa partikel untuk CSS murni */
      .circle-container:nth-child(1) { width: 8px; height: 8px; animation-duration: 12s; animation-delay: 1s; left: 10%; }
      .circle-container:nth-child(2) { width: 5px; height: 5px; animation-duration: 9s; animation-delay: 4s; left: 50%; }
      .circle-container:nth-child(3) { width: 10px; height: 10px; animation-duration: 15s; animation-delay: 7s; left: 90%; }
      .circle-container:nth-child(4) { width: 6px; height: 6px; animation-duration: 10s; animation-delay: 2s; left: 30%; }
      .circle-container:nth-child(5) { width: 7px; height: 7px; animation-duration: 11s; animation-delay: 5s; left: 70%; }
      /* ... bisa tambahkan lebih banyak variasi jika perlu ... */

      /* ================================================== */
      /* --- STYLE DARI index.css KAMU --- */
      /* ================================================== */

      @media (max-width: 768px) {
        header h1 { font-size: 2em; }
        nav ul { flex-wrap: wrap; gap: 10px; }
        nav li { margin: 5px; }
        #search-input { width: 100%; max-width: 600px; padding: 12px 20px; border: 2px solid #ffa200; border-radius: 25px; background: rgba(255, 255, 255, 0.1); color: white; transition: all 0.3s ease; }
        #search-input:focus { outline: none; box-shadow: 0 0 15px rgba(255, 162, 0, 0.5); }
        .anime-list { grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; }
        .anime-item { width: 100%; padding: 10px; }
        .anime-item img { width: 100%; height: auto; max-height: 120px; }
        .stylebutton { padding: 8px 16px; background-color: #ffa200; color: #fff; border: none; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; }
        .stylebutton:hover { background-color: #ff8c00; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); }
        .main img { width: 80%; height: auto; padding: 15px; }
        .main h3 { margin-left: 20px; font-size: 16px; }
        .main p { margin: 15px; padding: 8px; }
        .video { width: 95%; height: auto; aspect-ratio: 16/9; }
      }

      @media (max-width: 768px) {
        .stylebutton { padding: 6px 12px; font-size: 0.9em; }
      }

      @media (max-width: 480px) {
        .anime-list { grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); }
        .anime-item img { max-height: 100px; }
        .main h2 { font-size: 1.5em; }
        .main a { padding: 15px; margin: 15px; }
        nav a { font-size: 0.9em; }
        .video { width: 100%; }
      }

      /* === Style untuk Profile Image (PERBAIKAN) === */
      .profile-btn { /* Style untuk link container profile */
          display: flex;
          align-items: center;
          gap: 10px; /* Jarak antara gambar dan nama */
          text-decoration: none; /* Hapus underline dari link */
          color: white !important; /* Pastikan warna teks putih */
      }
      .profile-img {
        width: 35px; /* Ukuran gambar profil */
        height: 35px;
        border-radius: 50%; /* Membuat gambar menjadi bulat */
        border: 2px solid #ffa200; /* Border oranye */
        object-fit: cover; /* Memastikan gambar mengisi area tanpa distorsi */
        vertical-align: middle; /* Agar sejajar dengan teks nama */
        box-shadow: 0 0 8px rgba(255, 162, 0, 0.5); /* Efek glow */
        transition: transform 0.3s ease, box-shadow 0.3s ease; /* Transisi */
      }
      .profile-btn:hover .profile-img {
        transform: scale(1.1); /* Sedikit membesar saat di-hover */
        box-shadow: 0 0 12px rgba(255, 162, 0, 0.8); /* Glow lebih terang */
      }
      /* ================================================ */

      img {
        max-width: 100%;
        height: auto;
      }

      @media (hover: none) {
        .anime-item img:hover { transform: none; }
        .main a:hover { background: initial; animation: none; }
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
        z-index: 2;
      }
      .container a { text-decoration: none; color: #ccc; }
      .container a:hover { text-decoration: underline; color: #ffa200; }

      .logo-head { justify-content: center; margin: auto; }
      .nav1 { position: sticky; top: 0; }

      @import url("https://fonts.googleapis.com/css2?family=Play&display=swap");

      .title {
        font-size: 45px;
        width: 100%;
        margin: 2rem auto;
        display: inline-flex;
        justify-content: center;
        -webkit-box-reflect: below -10px linear-gradient(transparent, rgba(0, 0, 0, 0.15));
        position: relative;
      }
      .title span {
        display: inline-flex;
        font-family: "Play", sans-serif;
        animation: title-bounce 2.5s infinite, fire 2s ease-in-out infinite alternate;
        margin: 0 3px;
        color: #ffa200;
        text-shadow: 0 0 10px #ff6b00;
      }
      @keyframes title-bounce { 0%, 60%, 100% { transform: translateY(0) scale(1); } 30% { transform: translateY(-25px) scale(1.15); } }
      @keyframes fire { 0% { text-shadow: 0 0 10px #ff6b00, 0 0 20px #ff6b00, 0 0 30px #ff6b00; } 100% { text-shadow: 0 0 20px #ff6b00, 0 0 40px #ff6b00, 0 0 50px #ff6b00; } }
      .title span:nth-child(1) { animation-delay: 0.3s; }
      .title span:nth-child(2) { animation-delay: 0.4s; }
      .title span:nth-child(3) { animation-delay: 0.5s; }
      .title span:nth-child(4) { animation-delay: 0.6s; }
      .title span:nth-child(5) { animation-delay: 0.7s; }
      .title span:nth-child(6) { animation-delay: 0.8s; }
      .title span:nth-child(7) { animation-delay: 0.9s; }

      header { text-align: center; position: relative; z-index: 2; }
      header h1 { font-size: 3em; margin: 0; }

      .abt { background-color: rgba(24, 24, 24, 0.7); backdrop-filter: blur(5px); position: fixed; top: 0; left: 0; right: 0; padding: 10px 20px; z-index: 10; display: flex; justify-content: flex-start; align-items: center; }
      .abt a { position: relative; text-decoration: none; color: gray; background-color: transparent; padding: 5px; border-radius: 6px; opacity: 1; }
      .abt a:hover { color: #ffa200; }
      .abt a:first-child { position: static; /* Hapus absolute agar normal */ }

      nav { background-color: #181818; padding: 10px; border-radius: 15px; opacity: 0.7; }
      nav ul { font-weight: bold; list-style: none; margin: 0; padding: 0; display: flex; justify-content: space-around; align-items: center; }
      nav li { margin: 10px; }
      nav a { color: #ffa200; text-decoration: none; border-radius: 10px; transition: background-color 0.3s ease; }
      nav a:hover { text-decoration: underline; color: #ff8c00; /* Ganti biru jadi orange lebih gelap */ }

      .title { align-items: center; margin-top: 20px; }

      .suggestions { position: absolute; top: 100%; left: 0; right: 0; background-color: gray; border: 1px solid black; border-radius: 5px; max-height: 150px; overflow-y: auto; z-index: 1000; display: none; width: 100%; box-sizing: border-box; }
      .suggestion-item { color: white; padding: 10px; cursor: pointer; background-color: transparent; }
      .suggestion-item:hover { background-color: #f0f0f0; color: #181818; }

      .data { display: none; }
      .nama h2 { color: #ffa200; font-size: 2em; margin-bottom: 10px; }

      .anime-list { justify-content: center; display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; }
      .anime-list p { color: rgba(4, 235, 4, 0.452); transition: color 0.2s ease-in-out; }

      @media (max-width: 767px) {
        .anime-list { margin: 15px; display: grid; flex-wrap: wrap; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 17px; justify-items: center; }
      }

      .anime-item {
        background-color: #282828;
        border-radius: 15px;
        padding: 15px;
        width: 130px; /* Sedikit lebar lagi */
        height: auto;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        transition: transform 0.2s ease; /* Transisi untuk hover item */
      }
      .anime-item:hover {
        transform: translateY(-5px); /* Efek naik sedikit saat hover item */
      }

      .anime-item img {
        width: 100%;
        height: 160px; /* Tinggi sedikit ditambah */
        object-fit: cover;
        border-radius: 8px;
        transition: transform 0.3s ease-in-out;
        margin-bottom: 10px; /* Jarak gambar ke judul */
      }
      .anime-item a:hover img {
        transform: scale(1.05); /* Scale gambar saat link dihover */
      }

      .anime-item .anime-title-link { /* Kontainer untuk link judul */
          width: 100%;
          margin-bottom: 8px; /* Jarak judul ke tombol favorit */
      }
      .anime-item .anime-title-link a {
          text-decoration: none;
      }
      .anime-item .anime-title-link span {
        display: block; /* Agar span mengambil lebar penuh */
        font-size: 0.9em;
        word-break: break-word;
        overflow-wrap: break-word;
        font-weight: 600; /* Sedikit tebal */
        color: #eee;
        line-height: 1.3; /* Spasi baris */
        min-height: 2.6em; /* Tinggi minimum untuk 2 baris */
        transition: color 0.2s ease;
      }
      .anime-item .anime-title-link a:hover span {
        text-decoration: underline;
        color: #ffa200;
      }


      /* === Style Baru untuk Tombol Favorit (PERBAIKAN) === */
      .anime-item .add-favorite-button {
        display: inline-flex; /* Agar ikon dan teks sejajar */
        align-items: center;
        justify-content: center;
        gap: 6px; /* Jarak antara ikon dan teks */
        width: auto; /* Lebar otomatis */
        min-width: 95px; /* Lebar minimum */
        margin: auto auto 5px; /* Atas:otomatis, Kiri/Kanan:otomatis (tengah), Bawah:5px */
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 600;
        color: #ccc; /* Default: abu-abu muda */
        background-color: #3a3a3a; /* Default: abu-abu gelap */
        border: 1px solid #555;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: none;
      }

      .anime-item .add-favorite-button:hover {
        background-color: #ffa200;
        color: #181818; /* Warna teks/ikon jadi gelap */
        border-color: #ffa200;
        transform: translateY(-2px);
      }

      /* Style Saat Sudah Difavoritkan (via class 'favorited') */
      .anime-item .add-favorite-button.favorited {
        background-color: #ffa200;
        color: #181818;
        border-color: #ff8c00;
      }

      /* Ganti ikon menjadi solid saat difavoritkan */
      .anime-item .add-favorite-button.favorited i {
         font-weight: 900; /* Gunakan font-weight solid */
      }
      /* Kita tidak perlu ::before jika sudah pakai far/fas di HTML */

      /* HAPUS STYLE favorite-btn LAMA YANG MENGGUNAKAN POSITION ABSOLUTE */
      /* .favorite-btn { ... } */
      /* .favorite-btn:hover { ... } */
      /* .favorite-btn.favorited { ... } */
      /* .favorite-btn.favorited:hover { ... } */
      /* ================================================ */


      .home, .back { /* Style untuk tombol lain jika ada */
        font-size: 25px;
        background-color: rgb(48, 45, 45);
        padding: 20px;
        border-radius: 20px;
        text-decoration: none;
        color: white;
        transition: text-decoration 0.3s;
      }
      .home:hover, .back:hover { text-decoration: underline; color: #ffa200; }
      .back { margin-left: 20px; }

      .main { text-align: center; margin-top: 5%; }
      .main img { margin-bottom: 50px; width: 350px; background-color: #383434; padding: 25px; border-radius: 30px; }
      @media only screen and (max-width: 767px) { .main img { width: 200px; height: 250px; } }
      .main h2 { font-weight: bold; color: #ffa200; font-size: 35px; }
      @media only screen and (max-width: 767px) { .main h2 { } }
      .main h3 { margin-bottom: 15px; margin-left: 50px; text-align: start; font-size: 20px; color: #ffa200; }
      @media only screen and (max-width: 767px) { .main h3 { margin-left: 0; text-align: center; } }
      .main p { margin: 25px; letter-spacing: 1px; text-align: left; background-color: #383434; border-radius: 20px; padding: 10px; }
      @media only screen and (max-width: 767px) { .main p { text-align: center; margin: 15px; } }
      .main a { text-align: center; padding: 20px; font-size: 15px; color: #ffa200; text-decoration: none; display: block; margin: 25px; background-color: #282828; border-radius: 10px; }
      .main a:hover { background: linear-gradient(-45deg, #282828 40%, #fafafa 50%, #282828 60%); background-size: 300%; background-position-x: 100%; animation: shimmer 1.5s infinite linear; }
      @media only screen and (max-width: 767px) { .main a:active { background: linear-gradient(-45deg, #282828 40%, #fafafa 50%, #282828 60%); background-size: 300%; background-position-x: 100%; animation: shimmer 1.5s infinite linear; } }
      @keyframes shimmer { to { background-position-x: 0%; } }

      .batas { margin: 20px; border-color: #ffa200; }

      .video { position: relative; overflow: hidden; width: 48%; height: 460px; margin: 0 auto; }
      @media (max-width: 767px) { .video { width: 100%; height: calc(100vw * 9 / 16); max-height: 100%; margin: 0 auto; } }

      /* Footer */
      .footer { background-color: #1f1f1f; color: #fff; padding: 20px 0; font-size: 14px; position: relative; z-index: 3; margin-top: 50px; }
      .footer-section { display: flex; justify-content: space-around; align-items: flex-start; flex-wrap: wrap; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
      .footer-item { width: 30%; min-width: 200px; margin-bottom: 20px; padding: 0 10px; box-sizing: border-box; text-align: left; }
      .footer-item h3 { display: block; margin: 0 0 10px 0; font-size: 18px; border-bottom: 1px solid #444; padding-bottom: 5px; color: orange; text-align: left; }
      .social-links-container { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; align-items: flex-start; }
      .footer-item p { margin: 0; display: flex; align-items: center; font-size: 14px; }
      .social-icon { margin-right: 8px; vertical-align: middle; width: 20px; height: auto; color: #fff; transition: all 0.3s ease; flex-shrink: 0; }
      .trakteer-icon { width: 20px; height: auto; }
      .footer-item p a { color: #ccc; text-decoration: none; transition: color 0.3s ease; }
      .footer-item p a:hover { color: #ffa200; text-decoration: underline; }
      .social-icon:hover { transform: scale(1.2); color: #ffa200; filter: brightness(1.5); }
      @media (min-width: 769px) { .footer-section { justify-content: space-between; gap: 20px; } .footer-item { width: 30%; margin-bottom: 0; text-align: left; } .social-links-container { flex-direction: row; flex-wrap: wrap; gap: 15px; justify-content: flex-start; } .footer-item p { margin-right: 15px; margin-bottom: 5px; } }
      @media (max-width: 768px) { .footer-section { flex-direction: column; align-items: center; gap: 30px; padding: 0 10px; } .footer-item { width: 95%; min-width: auto; margin-bottom: 0; padding: 0; text-align: center; } .footer-item h3 { text-align: center; margin-bottom: 15px; } .social-links-container { flex-direction: column; align-items: center; gap: 10px; margin-top: 5px; } .footer-item p { justify-content: center; margin-right: 0; } .social-icon { width: 18px; } }

      main { position: relative; z-index: 2; }
      section.nama { margin-top: 20px; }
      .notice { margin: 20px auto; padding: 15px; background-color: rgba(40, 40, 40, 0.8); border-radius: 8px; max-width: 600px; text-align: center; color: #ccc; position: relative; z-index: 2; }
      .notice p { margin-bottom: 10px; }
      .notice p:last-child { margin-bottom: 0; }

      #notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 15px 30px; border-radius: 25px; color: white; font-weight: bold; z-index: 10000; opacity: 0; transition: all 0.3s ease; pointer-events: none; }
      #notification.visible { opacity: 1; bottom: 30px; }
      #notification.success { background: #28a745; }
      #notification.error { background: #dc3545; }
      #notification.info { background: #17a2b8; }

      .cookie-consent { position: fixed; bottom: -100%; left: 0; right: 0; background: rgba(0, 0, 0, 0.95); color: white; padding: 15px; z-index: 9999; transition: bottom 0.5s ease; border-top: 2px solid #ffa200; }
      .cookie-consent.show { bottom: 0; }
      .cookie-content { max-width: 1200px; margin: 0 auto; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; justify-content: space-between; }
      .cookie-content p { margin: 0; flex: 1; min-width: 300px; font-size: 0.9em; }
      .cookie-content a { color: #ffa200; text-decoration: underline; }
      .cookie-buttons { display: flex; gap: 10px; flex-shrink: 0; }
      #cancel-cookies { background-color: #444; border: 1px solid #666; }
      #cancel-cookies:hover { background-color: #666; }

      .pagination-container { margin: 20px 0; display: flex; justify-content: center; position: relative; z-index: 2; }
      .pagination-controls { display: flex; gap: 15px; align-items: center; background-color: rgba(40, 40, 40, 0.8); padding: 10px 20px; border-radius: 20px; }
      .pagination-btn { padding: 8px 16px; background: #ffa200; border: none; border-radius: 4px; color: #181818; cursor: pointer; transition: all 0.3s; font-weight: bold; }
      .pagination-btn:hover:not(:disabled) { background: #ff8c00; transform: translateY(-2px); }
      .pagination-btn:disabled { background: #666; cursor: not-allowed; opacity: 0.7; }
      .page-info { color: #fff; font-size: 1em; font-weight: bold; }

      #myDynamicSplash { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: #181818; display: flex; align-items: center; justify-content: center; text-align: center; z-index: 9999; transition: opacity 0.5s ease; }
      .splash-content { position: relative; z-index: 10000; }
      .splash-title { font-size: 45px; margin-bottom: 2rem; display: flex; justify-content: center; position: relative; }
      .splash-title span { display: inline-flex; font-family: "Play", sans-serif; animation: title-bounce 2.5s infinite, fire 2s ease-in-out infinite alternate; margin: 0 3px; color: #ffa200; text-shadow: 0 0 10px #ff6b00; }
      .sk-cube-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; width: 40px; height: 40px; justify-content: center; align-items: center; margin: auto; }
      .sk-cube { width: 10px; height: 10px; background-color: #ffa200; animation: sk-cubeGridScaleDelay 1.3s infinite ease-in-out; }
      @keyframes sk-cubeGridScaleDelay { 0%, 70%, 100% { transform: scale3D(1, 1, 1); } 35% { transform: scale3D(0, 0, 1); } }
      .network-status { position: absolute; bottom: 20%; left: 50%; transform: translateX(-50%); color: #ff5555; font-size: 1.2em; text-align: center; opacity: 0; transition: opacity 0.3s ease; width: 80%; max-width: 300px; }
      .network-status.show { opacity: 1; }

      .genre-filter { margin: 20px auto; padding: 10px; background: rgba(0, 0, 0, 0.7); border-radius: 30px; position: relative; max-width: 1000px; z-index: 2; }
      .genre-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 0 10px; }
      .genre-toggle { background: none; border: none; padding: 5px; cursor: pointer; transition: transform 0.3s ease; }
      .genre-toggle:hover { transform: scale(1.2); }
      .genre-toggle:hover path { fill: #ffd700; }
      .genre-list-container { max-height: 500px; overflow: hidden; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
      .genre-list-container.collapsed { max-height: 0; opacity: 0; }
      .genre-list { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; padding: 5px 10px; justify-content: center; }
      .genre-btn { padding: 8px 20px; background: #3a3a3a; border: none; border-radius: 25px; color: white; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; font-weight: bold; }
      .genre-btn:hover { background: #ffa200; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(255, 162, 0, 0.3); }
      .genre-btn::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, #ffa200, #ffd900); opacity: 0; transition: opacity 0.3s ease; z-index: 1; }
      .genre-btn:hover::before { opacity: 0.2; }
      .genre-btn.selected { background: #ffa200; transform: translateY(-3px); box-shadow: 0 5px 20px rgba(255, 162, 0, 0.4); animation: genreSelect 0.4s ease forwards; }
      @keyframes genreSelect { 0% { transform: translateY(0); } 50% { transform: translateY(-5px); } 100% { transform: translateY(-3px); } }

      .anime-list.slide-up { transform: translateY(-20px); opacity: 0.8; }
      @keyframes slideIn { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
      .genre-list-container:not(.collapsed) .genre-list { animation: slideIn 0.3s ease-out; }

      #search-input { position: relative; width: 100%; max-width: 600px; padding: 12px 20px; font-size: 16px; border: 2px solid #ffa200; border-radius: 25px; background: rgba(255, 255, 255, 0.1); color: white; transition: all 0.3s ease; }
      #search-input:focus { outline: none; box-shadow: 0 0 15px rgba(255, 162, 0, 0.5); border-color: #ff6b00; }
      #search-input:hover { transform: scale(1.02); background: rgba(255, 255, 255, 0.15); }
      .search-container { position: sticky; top: 0; z-index: 1000; padding: 15px 0; transition: all 0.3s ease; text-align: center; }
      @media (max-width: 768px) { .search-container { padding: 10px 0; } #search-input { font-size: 14px; padding: 10px 15px; max-width: 90%; } }

    </style>
    <!-- ================================================== -->
    <!-- --- AKHIR STYLE CSS --- -->
    <!-- ================================================== -->
  </head>
  <body>
    <!-- ================================================== -->
    <!-- --- BACKGROUND PARTIKEL HTML --- -->
    <!-- ================================================== -->
    <div id="particles-background">
      <!-- Sebanyak 100 div.circle-container -->
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
      <div class="circle-container"><div class="circle"></div></div>
    </div>
    <!-- ================================================== -->
    <!-- --- AKHIR BACKGROUND PARTIKEL HTML --- -->
    <!-- ================================================== -->

    <div class="abt"><a href="About.html">ABOUT</a></div>

    <header>
      <div class="container">
        <h1 class="title">
          <span>M</span><span>y</span><span>A</span><span>n</span><span>i</span><span>m</span><span>e</span>
        </h1>
        <p>Support Saya Di</p>
        <p><a href="https://www.instagram.com/ransyah_32/">Instagram</a></p>
        <p><a href="https://trakteer.id/ransyah4">Trakteer!</a></p>
        <nav>
          <ul id="menu">
            <!-- Menu Awal (Akan Diupdate oleh JS) -->
            <li><a href="#">HOME</a></li>
            <li><a href="#" id="google-login-btn">LOGIN</a></li>
          </ul>
        </nav>
        <br />
        <div class="search-container">
          <input type="text" id="search-input" placeholder="Search.." name="keyword" />
          <div class="sparkle" id="sparkle-container"></div>
          <div class="suggestions"></div>
        </div>
      </div>
    </header>

    <main>
      <div class="genre-filter">
        <div class="genre-header">
          <h2 style="color: #ffa200">Genre</h2>
          <button class="genre-toggle">
            <svg class="arrow-down" width="24" height="24" viewBox="0 0 24 24"><path fill="#ffa200" d="M7 10l5 5 5-5z" /></svg>
            <svg class="arrow-up" width="24" height="24" viewBox="0 0 24 24" style="display: none"><path fill="#ffa200" d="M7 14l5-5 5 5z" /></svg>
          </button>
        </div>
        <div class="genre-list-container collapsed">
          <div class="genre-list"></div>
        </div>
      </div>
      <div id="notification"></div> <!-- Notifikasi dipindah sedikit ke atas -->
      <div class="container">
        <div class="notice">
          <p>masih dalam tahap sharing,</p>
          <p>Anime recommended dari saya,dan tidak semua genre ada ! ajak temanmu dan rekomendasikan anime favorit tanpa ads!</p>
        </div>
        <div id="content">
          <section class="nama">
            <h2>Anime Terbaru</h2>
            <div class="anime-list"></div>
          </section>
        </div>
      </div>
    </main>

    <div id="cookie-consent" class="cookie-consent">
      <div class="cookie-content">
        <p>Kami menggunakan cookie untuk meningkatkan pengalaman Anda. Dengan menggunakan situs ini, Anda setuju dengan <a href="/privacy">Kebijakan Privasi</a> kami.</p>
        <div class="cookie-buttons">
          <button id="accept-cookies" class="stylebutton">Setuju</button>
          <button id="cancel-cookies" class="stylebutton secondary">Batalkan</button>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="footer-section">
        <div class="footer-item">
          <h3>Hak Cipta</h3>
          <p>Hak Cipta © 2024 MyAnime.</p>
          <p>Dibuat dengan ❤️ oleh Ransyah.</p>
        </div>
        <div class="footer-item">
          <h3>Ikuti & Support</h3>
          <div class="social-links-container">
            <p><i class="fab fa-instagram social-icon"></i> <a href="https://www.instagram.com/ransyah_32/" target="_blank" rel="noopener noreferrer">Instagram</a></p>
            <p><img src="Gambar/trakteer_logo.png" alt="" class="trakteer-icon social-icon" /> <a href="https://trakteer.id/ransyah4" target="_blank" rel="noopener noreferrer">Trakteer!</a></p>
            <p><i class="fas fa-envelope social-icon"></i> <a href="mailto:rizky1234kb@gmail.com">Email</a></p>
          </div>
        </div>
        <div class="footer-item">
          <h3>Hubungi Kami</h3>
          <p><a href="mailto:rizky1234kb@gmail.com">rizky1234kb@gmail.com</a></p>
        </div>
      </div>
    </footer>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://unpkg.com/jwt-decode/build/jwt-decode.js"></script>

    <script>
      // --- SPLASH SCREEN ---
      function createSplashScreen() {
        const isHomePage = window.location.pathname.endsWith("index.html") || window.location.pathname === "/";
        if (!isHomePage) return null;
        const splashScreen = document.createElement("div");
        splashScreen.id = "myDynamicSplash";
        const contentWrapper = document.createElement("div");
        contentWrapper.className = "splash-content";
        const title = document.createElement("div");
        title.className = "splash-title";
        const letters = ["M", "y", "A", "n", "i", "m", "e"];
        letters.forEach((letter, index) => {
          const span = document.createElement("span");
          span.textContent = letter;
          span.style.animationDelay = `${0.3 + index * 0.1}s`;
          title.appendChild(span);
        });
        const cubeGrid = document.createElement("div");
        cubeGrid.className = "sk-cube-grid";
        for (let i = 1; i <= 9; i++) {
          const cube = document.createElement("div");
          cube.className = `sk-cube sk-cube${i}`;
          cubeGrid.appendChild(cube);
        }
        const errorMessage = document.createElement("div");
        errorMessage.className = "network-status";
        contentWrapper.appendChild(title);
        contentWrapper.appendChild(cubeGrid);
        contentWrapper.appendChild(errorMessage);
        splashScreen.appendChild(contentWrapper);
        document.body.prepend(splashScreen);
        return { splashScreen, errorMessage };
      }

      function initSplashScreen() {
        const splashData = createSplashScreen();
        if (!splashData) return;
        const { splashScreen, errorMessage } = splashData;
        let isLoaded = false;
        const showNetworkError = (message) => {
          errorMessage.textContent = message;
          errorMessage.classList.add("show");
        };
        if (!navigator.onLine) showNetworkError("Koneksi internet offline");
        window.addEventListener("offline", () => showNetworkError("Koneksi internet offline"));
        window.addEventListener("online", () => errorMessage.classList.remove("show"));
        const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
        if (connection) {
          connection.addEventListener("change", () => {
            if (connection.effectiveType === "slow-2g" || connection.effectiveType === "2g") {
              showNetworkError("Koneksi internet lemah terdeteksi");
            }
          });
        }
        const hideSplash = () => {
          if (isLoaded) return;
          isLoaded = true;
          splashScreen.style.opacity = "0";
          splashScreen.addEventListener("transitionend", () => {
            splashScreen.remove();
          });
        };
        const loadTimeout = setTimeout(() => {
          if (!isLoaded) showNetworkError("Memuat lebih lama dari biasanya...");
        }, 5000); // Meningkatkan timeout sedikit
        const handleLoad = () => {
          clearTimeout(loadTimeout);
          hideSplash();
        };
        if (document.readyState === "complete") {
          handleLoad();
        }
        // handleLoad akan dipanggil lagi setelah data load
        return handleLoad;
      }

      // --- AUTH SYSTEM ---
      const CLIENT_ID = "429779218315-46milavmlmmbb1b1v5p6v4mbh1o40uk6.apps.googleusercontent.com";
      const REDIRECT_URI = window.location.origin + window.location.pathname;

      function handleLogin() {
        console.log("Attempting Google login...");
        localStorage.removeItem("access_token");
        localStorage.removeItem("user_info");
        sessionStorage.removeItem("currentUser");
        const oauth2Url = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=token&scope=email profile&prompt=select_account`;
        window.location.href = oauth2Url;
      }

      function handleLogout() {
        console.log("Attempting Google logout...");
        localStorage.removeItem("access_token");
        localStorage.removeItem("user_info");
        sessionStorage.removeItem("currentUser");
        if (google && google.accounts && google.accounts.id) {
          google.accounts.id.disableAutoSelect();
          console.log("Google auto-select disabled.");
        }
        updateMenu(); // Update UI setelah logout
        console.log("User logged out.");
      }

      async function getUserInfo(accessToken) {
        console.log("Fetching user info...");
        try {
          const response = await fetch("https://www.googleapis.com/oauth2/v2/userinfo", { headers: { Authorization: `Bearer ${accessToken}` } });
          console.log("User info response status:", response.status);
          if (!response.ok) {
            throw new Error(`Gagal mengambil info pengguna: Status ${response.status}`);
          }
          const userInfo = await response.json();
          console.log("User info received:", userInfo);
          return userInfo;
        } catch (error) {
          console.error("Gagal mengambil info pengguna:", error);
          localStorage.removeItem("access_token");
          localStorage.removeItem("user_info");
          sessionStorage.removeItem("currentUser");
          return null;
        }
      }

      async function updateMenu() {
          console.log("Updating menu...");
          const menu = document.getElementById("menu");
          if (!menu) {
              console.warn("Nav menu element (#menu) not found!");
              return;
          }

          const accessToken = localStorage.getItem("access_token");
          let userInfo = null;
          try {
              userInfo = JSON.parse(localStorage.getItem("user_info"));
          } catch (e) {
              console.warn("Could not parse user_info from localStorage", e);
              localStorage.removeItem("user_info"); // Clear invalid data
          }

          let sessionUser = null;
          try {
              sessionUser = JSON.parse(sessionStorage.getItem("currentUser"));
          } catch (e) {
              console.warn("Could not parse currentUser from sessionStorage", e);
              sessionStorage.removeItem("currentUser"); // Clear invalid data
          }

          const currentUserInfo = sessionUser || userInfo;

          if (accessToken && currentUserInfo) {
              console.log("User is logged in:", currentUserInfo);
              menu.innerHTML = `
                  <li><a href="favorites.html">Favorites</a></li>
                  <li>
                      <a href="#" id="logout-btn" class="profile-btn">
                          <img src="${currentUserInfo.picture || 'Gambar/default-avatar.png'}" alt="Profile" class="profile-img"> {/* Fallback image */}
                          <span>${currentUserInfo.name || 'User'}</span> {/* Fallback name */}
                      </a>
                  </li>`;
              // Sync session storage to local storage if needed
              if (sessionUser && !userInfo) {
                  localStorage.setItem("user_info", JSON.stringify(sessionUser));
              }
          } else {
              console.log("User is logged out.");
              menu.innerHTML = `
                  <li><a href="#">HOME</a></li>
                  <li><a href="#" id="google-login-btn">LOGIN</a></li>`;
              // Ensure storage is clean on logout state
              localStorage.removeItem("access_token");
              localStorage.removeItem("user_info");
              sessionStorage.removeItem("currentUser");
          }

          // Re-attach event listeners using delegation on the body
          document.body.removeEventListener("click", handleMenuClick); // Remove previous listener first
          document.body.addEventListener("click", handleMenuClick);

          console.log("Menu updated.");
      }

      // Define handleMenuClick outside updateMenu so it's accessible
      function handleMenuClick(e) {
          if (e.target.closest("#google-login-btn")) {
              e.preventDefault();
              handleLogin();
          }
          if (e.target.closest("#logout-btn")) {
              e.preventDefault();
              handleLogout();
          }
      }


      async function initAuth() {
        console.log("Initializing Auth...");
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const accessToken = params.get("access_token");

        if (accessToken) {
          console.log("✅ Access token ditemukan di URL hash.");
          try {
            const userInfo = await getUserInfo(accessToken);
            if (userInfo && (userInfo.email || userInfo.id)) { // Check for email or id
              console.log("✅ Info pengguna berhasil diambil:", userInfo);
              localStorage.setItem("access_token", accessToken);
              localStorage.setItem("user_info", JSON.stringify(userInfo));
              sessionStorage.setItem("currentUser", JSON.stringify({
                id: userInfo.id || userInfo.sub, // Use id or sub
                name: userInfo.name,
                picture: userInfo.picture,
                email: userInfo.email
              }));
              history.replaceState(null, "", window.location.pathname); // Clean URL
              console.log("✅ Auth berhasil diinisialisasi dari redirect.");
            } else {
               // getUserInfo already handled cleanup if info is invalid/incomplete
              console.error("❌ Auth gagal: Info pengguna tidak lengkap atau tidak valid.");
               // Optionally show user a message here
            }
          } catch (error) {
            console.error("❌ Auth gagal saat memproses token:", error);
            alert("Login gagal. Silakan coba lagi!");
          }
        } else {
          console.log("🔍 Tidak ada access token di hash URL. Mengecek Local Storage.");
          // No new token, check existing login status from storage
          // updateMenu will handle displaying the correct state
        }
        // Update menu regardless of whether a new token was processed
        await updateMenu(); // Make sure menu is updated AFTER potential auth changes
      }

      // --- PAGINATION & DATA LOADING ---
      let currentPage = 1;
      let itemsPerPage = 27; // Jumlah item per halaman (pastikan sesuai keinginan)
      let totalPages = 1;
      let allAnimeData = [];
      let filteredData = [];
      const JSON_PATH = "./anime-data.json"; // Pastikan path ini benar!

      async function loadAnimeData() {
        console.log("🔄 Memulai load data dari:", JSON_PATH);
        try {
          const response = await fetch(JSON_PATH);
          console.log("🔍 Status response:", response.status);
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          const contentType = response.headers.get("content-type");
          if (!contentType || !contentType.includes("application/json")) {
             // Coba parsing teks jika header salah tapi konten mungkin JSON
             console.warn("Header content-type bukan application/json, mencoba parsing teks...");
             const text = await response.text();
             try {
                 const data = JSON.parse(text);
                 console.log("✅ Data berhasil diparsing dari teks:", data);
                 // Validasi struktur setelah parsing dari teks
                  if (!data || !Array.isArray(data.data)) {
                    if (Array.isArray(data)) {
                      console.warn("Struktur JSON tidak memiliki properti 'data'. Menggunakan array langsung.");
                      return data; // Langsung kembalikan jika data adalah array
                    }
                    throw new Error("Struktur JSON dari teks tidak valid.");
                  }
                 return data.data;
             } catch (parseError) {
                 console.error("❌ Gagal parsing teks sebagai JSON:", parseError, "Konten teks:", text);
                 throw new Error("Response bukan JSON valid.");
             }
          }
          // Jika header benar application/json
          const data = await response.json();
          console.log("✅ Data diterima (application/json):", data);
          // Validasi struktur
          if (!data || !Array.isArray(data.data)) {
             if (Array.isArray(data)) {
                 console.warn("Struktur JSON tidak memiliki properti 'data'. Menggunakan array langsung.");
                 return data;
             }
            throw new Error("Struktur JSON tidak valid: properti 'data' tidak ditemukan atau bukan array.");
          }
          return data.data; // Kembalikan array anime
        } catch (error) {
          console.error("❌ Error kritikal saat memuat data anime:", error);
          showNotification(`Gagal memuat data anime: ${error.message}. Cek path & file JSON.`, "error", 5000); // Tampilkan notif lebih lama
          return []; // Kembalikan array kosong
        }
      }


      // --- RENDERING ---
      function renderAnimeItems(data) {
        const animeList = document.querySelector(".anime-list");
        if (!animeList) { console.error("Container .anime-list tidak ditemukan!"); return; }
        animeList.innerHTML = ""; // Clear previous items

        if (data.length === 0) {
          animeList.innerHTML = '<p style="text-align: center; color: #ccc; width: 100%;">Tidak ada anime ditemukan.</p>'; // Style width 100%
          return;
        }

        const favorites = JSON.parse(localStorage.getItem("favorites")) || [];
        const favoriteSlugs = new Set(favorites.map(fav => fav.slug));

        animeList.innerHTML = data.map((anime) => {
          const slug = anime.slug || "#" + Date.now(); // Fallback slug unik jika tidak ada
          const imageUrl = anime.image || "Gambar/default-thumbnail.png";
          const title = anime.title || "Judul Tidak Diketahui";
          const isFavorited = favoriteSlugs.has(slug);
          const escapedSlug = slug.replace(/'/g, "\\'").replace(/"/g, '"'); // Escape single and double quotes
          const escapedTitle = title.replace(/'/g, "\\'").replace(/"/g, '"');
          const escapedImageUrl = imageUrl.replace(/'/g, "\\'").replace(/"/g, '"');


          return `
              <div class="anime-item">
                <a href="anime.html?slug=${encodeURIComponent(slug)}">
                  <img src="${imageUrl}" alt="${escapedTitle}" loading="lazy">
                </a>
                <div class="anime-title-link">
                  <a href="anime.html?slug=${encodeURIComponent(slug)}">
                    <span>${title}</span>
                  </a>
                </div>
                <button
                  class="add-favorite-button ${isFavorited ? 'favorited' : ''}"
                  onclick="addToFavorites({ slug: '${escapedSlug}', title: '${escapedTitle}', image: '${escapedImageUrl}' }, this)">
                  <i class="far fa-bookmark"></i>
                  <span>${isFavorited ? 'Disimpan' : 'Simpan'}</span>
                </button>
              </div>
          `;
        }).join("");
      }

      function renderPagination() {
        let paginationContainer = document.querySelector(".pagination-container");
        if (!paginationContainer) {
          paginationContainer = document.createElement("div");
          paginationContainer.className = "pagination-container";
          const mainElement = document.querySelector("main #content"); // Target #content dalam main
          if (mainElement) {
            mainElement.appendChild(paginationContainer); // Append ke #content
          } else {
             console.warn("Element #content not found for pagination. Appending to main.");
             document.querySelector("main")?.appendChild(paginationContainer); // Fallback ke main
          }
        }

         // Jangan render jika hanya 1 halaman atau tidak ada data
        if (totalPages <= 1) {
            paginationContainer.innerHTML = '';
            return;
        }

        paginationContainer.innerHTML = `
          <div class="pagination-controls">
            <button class="pagination-btn" id="prev-btn" ${currentPage === 1 ? "disabled" : ""}>Previous</button>
            <span class="page-info">Halaman ${currentPage} dari ${totalPages}</span>
            <button class="pagination-btn" id="next-btn" ${currentPage === totalPages ? "disabled" : ""}>Next</button>
          </div>`;
      }

      function updateDisplay() {
        console.log(`Updating display: Page ${currentPage}/${totalPages}, filtered items: ${filteredData.length}.`);
        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;

        const sectionTitle = document.querySelector(".nama h2");
        if (sectionTitle) {
          if (selectedGenre && selectedGenre !== 'All') { // Perbaiki kondisi genre
            sectionTitle.textContent = `Genre: ${selectedGenre}`;
          } else {
            sectionTitle.textContent = "Anime Terbaru";
          }
        } else {
            console.warn("Section title element (.nama h2) not found.");
        }

        renderAnimeItems(filteredData.slice(start, end));
        renderPagination(); // Pagination di-render ulang

        // Opsi: Scroll ke atas list anime, bukan top halaman
        const animeListElement = document.querySelector('.anime-list');
        if (animeListElement) {
             // Beri sedikit timeout agar rendering selesai
            setTimeout(() => {
                animeListElement.scrollIntoView({ behavior: "smooth", block: "start" });
            }, 100);
        } else {
            window.scrollTo({ top: 0, behavior: "smooth" }); // Fallback
        }

        console.log("Display updated.");
      }

      // --- SEARCH & FILTER ---
      const searchInput = document.getElementById("search-input");
      const suggestionsBox = document.querySelector(".suggestions");
      const sparkleContainer = document.getElementById("sparkle-container");
      let searchTimer;
      let selectedGenre = null; // Default null

      if (searchInput) {
        searchInput.addEventListener("input", function (e) {
          const searchValue = e.target.value.toLowerCase().trim(); // Trim spasi
          clearTimeout(searchTimer);
          searchTimer = setTimeout(() => {
            console.log("Searching for:", searchValue);
            filterAndDisplay(searchValue, selectedGenre);
          }, 300);
          // triggerSparkle(e); // Sparkle bisa mengganggu, opsional
        });
      } else { console.warn("Search input not found!"); }

      function filterAndDisplay(searchValue = "", genre = null) {
          console.log(`Filtering by search: "${searchValue}", genre: "${genre}"`);
          // Selalu mulai dari data asli
          let currentData = [...allAnimeData];

          // 1. Filter berdasarkan genre jika ada (dan bukan 'All')
          if (genre && genre !== "All") {
              currentData = currentData.filter(anime =>
                  anime.info?.genres?.includes(genre)
              );
              console.log(`After genre filter (${genre}): ${currentData.length} items`);
          }

          // 2. Filter berdasarkan search dari hasil filter genre (atau data asli)
          if (searchValue) {
              currentData = currentData.filter(anime => {
                  const titleMatch = anime.title?.toLowerCase().includes(searchValue);
                  // Optional: Tambahkan pencarian lain jika perlu
                  // const descMatch = anime.desc?.toLowerCase().includes(searchValue);
                  return titleMatch; // || descMatch;
              });
              console.log(`After search filter ("${searchValue}"): ${currentData.length} items`);
          }

          filteredData = currentData; // Simpan hasil akhir filter

          currentPage = 1; // Reset ke halaman 1
          totalPages = Math.ceil(filteredData.length / itemsPerPage);
          if(totalPages < 1) totalPages = 1; // Pastikan minimal 1 halaman

          updateDisplay(); // Update UI
          console.log(`Filtering complete. Total pages: ${totalPages}`);

          if (suggestionsBox) suggestionsBox.style.display = "none"; // Sembunyikan suggestions
      }


      function triggerSparkle(event) {
        if (!sparkleContainer) return;
        const inputRect = searchInput.getBoundingClientRect();
        const sparkleCount = 3; // Kurangi jumlah sparkle
        for (let i = 0; i < sparkleCount; i++) {
          const sparkle = document.createElement("span");
          const x = Math.random() * inputRect.width; // Posisi X acak di dalam input
          const y = Math.random() * inputRect.height; // Posisi Y acak di dalam input
          sparkle.style.left = `${x}px`;
          sparkle.style.top = `${y}px`;
          // Variasi ukuran sparkle (opsional)
          const size = Math.random() * 3 + 2; // Ukuran antara 2px - 5px
          sparkle.style.width = `${size}px`;
          sparkle.style.height = `${size}px`;
          // Variasi durasi animasi (opsional)
          sparkle.style.animationDuration = `${0.8 + Math.random() * 0.7}s`; // Durasi antara 0.8s - 1.5s

          sparkleContainer.appendChild(sparkle);
          sparkle.addEventListener("animationend", () => {
            sparkle.remove();
          });
        }
      }

      // --- GENRE FILTER ---
      function renderGenreFilters() {
        const genreContainer = document.querySelector(".genre-list");
        if (!genreContainer) { console.warn("Genre list container not found!"); return; }
        const allGenres = new Set();
        allAnimeData.forEach((anime) => {
          if (anime.info && Array.isArray(anime.info.genres)) {
            anime.info.genres.forEach((genre) => {
              if (typeof genre === "string" && genre.trim() !== "") {
                allGenres.add(genre.trim());
              }
            });
          }
        });
        const sortedGenres = Array.from(allGenres).sort();
        genreContainer.innerHTML = ""; // Clear existing buttons

        // Tombol "All"
        const allButton = document.createElement("button");
        allButton.className = "genre-btn";
        allButton.textContent = "All";
        // Set selected jika belum ada genre yang dipilih
        if (selectedGenre === null || selectedGenre === "All") {
            allButton.classList.add("selected");
        }
        allButton.addEventListener("click", () => {
          console.log("'All' genre button clicked.");
          filterByGenre("All"); // Gunakan "All" sebagai penanda
        });
        genreContainer.appendChild(allButton); // Tambahkan "All" dulu

        // Tombol genre spesifik
        sortedGenres.forEach((genre) => {
          const button = document.createElement("button");
          button.className = "genre-btn";
          button.textContent = genre;
          if (selectedGenre === genre) { // Set selected jika cocok
              button.classList.add("selected");
          }
          button.addEventListener("click", () => {
            console.log("Genre button clicked:", genre);
            filterByGenre(genre);
          });
          genreContainer.appendChild(button);
        });

        console.log("Genre filters rendered.");
      }

      function filterByGenre(genre) {
          const container = document.querySelector(".genre-list-container");
          const animeList = document.querySelector(".anime-list");
          const genreButtons = document.querySelectorAll(".genre-btn");

          if (!container || !animeList || genreButtons.length === 0) { console.warn("Missing elements for genre filtering."); return; }

          // Update tombol aktif
          genreButtons.forEach((btn) => {
              btn.classList.toggle("selected", btn.textContent === genre);
          });

          // Hanya filter jika genre berubah
          if (selectedGenre === genre) { console.log("Genre already selected:", genre); return; }

          selectedGenre = genre; // Update genre terpilih

          animeList.classList.add("slide-up"); // Animasi fade/slide (opsional)

          setTimeout(() => {
              // Panggil filter terpusat
              filterAndDisplay(searchInput ? searchInput.value.toLowerCase().trim() : "", selectedGenre);
              animeList.classList.remove("slide-up"); // Hapus class animasi
          }, 150); // Kurangi delay agar lebih responsif

          console.log("Filtering initiated by genre:", genre);

          // Tutup dropdown di mobile setelah memilih
          if (window.innerWidth <= 768 && !container.classList.contains('collapsed')) {
              container.classList.add("collapsed");
              const arrowDown = genreHeader?.querySelector(".arrow-down");
              const arrowUp = genreHeader?.querySelector(".arrow-up");
              if (arrowDown && arrowUp) {
                  arrowDown.style.display = "block";
                  arrowUp.style.display = "none";
              }
          }
      }


      const genreHeader = document.querySelector(".genre-header");
      if (genreHeader) {
        genreHeader.addEventListener("click", function () {
          const container = document.querySelector(".genre-list-container");
          const arrowDown = genreHeader.querySelector(".arrow-down");
          const arrowUp = genreHeader.querySelector(".arrow-up");
          if (!container || !arrowDown || !arrowUp) { console.warn("Missing elements for genre toggle."); return; }
          const isCollapsed = container.classList.toggle("collapsed");
          arrowDown.style.display = isCollapsed ? "block" : "none";
          arrowUp.style.display = isCollapsed ? "none" : "block";
          console.log("Genre list toggled. Collapsed:", isCollapsed);
        });
      } else { console.warn("Genre header not found!"); }


      // --- FAVORITES SYSTEM (PERBAIKAN) ---
      function addToFavorites(anime, buttonElement) {
        // Ambil user info terbaru dari storage
        let currentUserInfo = JSON.parse(sessionStorage.getItem("currentUser")) || JSON.parse(localStorage.getItem("user_info"));

        if (!currentUserInfo || !currentUserInfo.id) {
          showNotification("Silakan login terlebih dahulu untuk menambahkan favorit!", "error");
          return;
        }

        let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
        const favoriteIndex = favorites.findIndex((fav) => fav.slug === anime.slug);
        const buttonTextSpan = buttonElement ? buttonElement.querySelector('span') : null;
        const buttonIcon = buttonElement ? buttonElement.querySelector('i') : null;

        if (favoriteIndex > -1) { // Jika SUDAH ADA -> Hapus
          favorites.splice(favoriteIndex, 1);
          localStorage.setItem("favorites", JSON.stringify(favorites));
          showNotification("Anime dihapus dari favorit!", "info");
          if (buttonElement) {
            buttonElement.classList.remove('favorited');
            if(buttonTextSpan) buttonTextSpan.textContent = 'Simpan';
            if(buttonIcon) buttonIcon.className = 'far fa-bookmark'; // Kembali ke outline
          }
          console.log("Removed from Favorites:", anime.slug);
        } else { // Jika BELUM ADA -> Tambah
          favorites.push(anime);
          localStorage.setItem("favorites", JSON.stringify(favorites));
          showNotification("Anime berhasil ditambahkan ke favorit!", "success");
          if (buttonElement) {
            buttonElement.classList.add('favorited');
            if(buttonTextSpan) buttonTextSpan.textContent = 'Disimpan';
            if(buttonIcon) buttonIcon.className = 'fas fa-bookmark'; // Ubah ke solid
          }
          console.log("Added to Favorites:", anime.slug);
        }
        console.log("Current Favorites count:", favorites.length);
      }

      // --- NOTIFICATION SYSTEM ---
      function showNotification(message, type = "info", duration = 3000) {
        const notification = document.getElementById("notification");
        if (!notification) { console.warn("Notification element not found!"); alert(message); return; }

        // Hapus timeout yang mungkin sedang berjalan untuk notifikasi sebelumnya
        if (notification.timer) {
            clearTimeout(notification.timer);
        }

        notification.className = "notification"; // Reset class
        notification.textContent = message;
        notification.classList.add(type);
        void notification.offsetWidth; // Reflow needed for transition
        notification.classList.add("visible");

        // Set timeout baru
        notification.timer = setTimeout(() => {
          notification.classList.remove("visible");
          notification.timer = null; // Hapus referensi timer
        }, duration);
      }

      // --- EVENT LISTENERS ---
      document.body.addEventListener("click", (e) => {
        // Pagination
        if (e.target.id === "prev-btn" && !e.target.disabled) {
             e.preventDefault();
             if (currentPage > 1) { currentPage--; updateDisplay(); console.log("Pagination: Previous page"); }
        }
        if (e.target.id === "next-btn" && !e.target.disabled) {
             e.preventDefault();
             if (currentPage < totalPages) { currentPage++; updateDisplay(); console.log("Pagination: Next page"); }
        }
         // Login/logout sudah dihandle di handleMenuClick
      });

      // Cookie Consent
      const cookieConsent = document.getElementById("cookie-consent");
      const acceptCookiesBtn = document.getElementById("accept-cookies");
      const cancelCookiesBtn = document.getElementById("cancel-cookies");
      if (cookieConsent && acceptCookiesBtn && cancelCookiesBtn) {
        const consentGiven = localStorage.getItem("cookie_consent");
        if (!consentGiven) {
          // Tampilkan setelah delay sedikit agar tidak terlalu intrusif saat load awal
          setTimeout(() => { cookieConsent.classList.add("show"); }, 1500);
        }
        acceptCookiesBtn.addEventListener("click", () => { localStorage.setItem("cookie_consent", "given"); cookieConsent.classList.remove("show"); console.log("Cookie consent given."); });
        cancelCookiesBtn.addEventListener("click", () => { localStorage.setItem("cookie_consent", "denied"); cookieConsent.classList.remove("show"); console.log("Cookie consent denied."); });
      } else { console.warn("Cookie consent elements not found."); }

      // --- INITIALIZATION ---
      document.addEventListener("DOMContentLoaded", async () => {
        console.log("DOM fully loaded. Starting initialization...");
        const hideSplash = initSplashScreen(); // Jalankan splash screen

        try {
            await initAuth(); // Inisialisasi otentikasi & update menu
            allAnimeData = await loadAnimeData(); // Muat data anime

            if (allAnimeData.length > 0) {
                console.log(`✅ Data anime berhasil dimuat: ${allAnimeData.length} items.`);
                filterAndDisplay("", null); // Tampilkan semua data awal
                renderGenreFilters(); // Render filter genre
            } else {
                console.warn("⚠️ Tidak ada data anime yang dimuat atau array kosong.");
                // Tampilkan pesan di area list jika kosong
                 const animeList = document.querySelector(".anime-list");
                 if(animeList) animeList.innerHTML = '<p style="text-align: center; color: #ccc; width: 100%;">Gagal memuat anime atau tidak ada data.</p>';
                 renderPagination(); // Pastikan pagination kosong jika tidak ada data
            }
        } catch (error) {
             console.error("❌ Terjadi error saat inisialisasi:", error);
             showNotification("Terjadi kesalahan saat memuat halaman.", "error");
             // Tampilkan pesan error di area list
             const animeList = document.querySelector(".anime-list");
             if(animeList) animeList.innerHTML = '<p style="text-align: center; color: red; width: 100%;">Error memuat data. Coba refresh halaman.</p>';
             renderPagination();
        } finally {
            // Sembunyikan splash screen setelah semua proses selesai (atau gagal)
            if (hideSplash) setTimeout(hideSplash, 500); // Beri sedikit delay
            console.log("Initialization complete.");
        }
      });
    </script>

  </body>
</html>